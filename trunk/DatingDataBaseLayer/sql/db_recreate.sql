
DROP TABLE MESSAGES;
DROP TABLE USER_PICTURES;
DROP TABLE USER_INTERESTS;
DROP TABLE USERS;
DROP TABLE USER_STARSIGNS;
DROP TABLE USER_CITIES;

DROP SEQUENCE SEQ_USERS;
DROP SEQUENCE SEQ_PICTURES;
DROP SEQUENCE SEQ_INTERESTS;
DROP SEQUENCE SEQ_MESSAGES;

CREATE SEQUENCE SEQ_USERS START WITH 100;
CREATE SEQUENCE SEQ_PICTURES START WITH 100;
CREATE SEQUENCE SEQ_INTERESTS START WITH 100;
CREATE SEQUENCE SEQ_MESSAGES START WITH 100; 


CREATE TABLE USERS
(
  USER_ID NUMBER NOT NULL,
  USER_NAME VARCHAR2(40) NOT NULL,
  USER_PASSWORD VARCHAR2(60) NOT NULL,
  USER_EMAIL VARCHAR2(60),
  USER_FULLNAME NVARCHAR2(80),
  USER_CITY NUMBER,
  USER_GENDER VARCHAR2(1 CHAR),
  USER_AGE NUMBER,
  USER_STARSIGN NUMBER,
  USER_PROFILE_VISITS NUMBER DEFAULT 0 NOT NULL,
  USER_ONLINE VARCHAR2(1) DEFAULT 'N' NOT NULL,
  CONSTRAINT USERS_PK PRIMARY KEY (USER_ID) ENABLE
);

ALTER TABLE USERS ADD CONSTRAINT USER_NAMES_UK1 UNIQUE (USER_NAME) ENABLE;

CREATE TABLE USER_CITIES
(
  USER_CITY_ID NUMBER NOT NULL,
  USER_CITY NVARCHAR2(100) UNIQUE NOT NULL,
  CONSTRAINT USER_CITIES_PK PRIMARY KEY (USER_CITY_ID) ENABLE
);

ALTER TABLE USERS ADD CONSTRAINT USER_CITIES_FK1 FOREIGN KEY(USER_CITY)
REFERENCES USER_CITIES(USER_CITY_ID) ENABLE; 

CREATE TABLE USER_STARSIGNS
(
  USER_STARSIGN_ID NUMBER NOT NULL,
  USER_STARSIGN NVARCHAR2(100) UNIQUE NOT NULL,
  CONSTRAINT USER_STARSIGNS_PK PRIMARY KEY (USER_STARSIGN_ID) ENABLE
);

ALTER TABLE USERS ADD CONSTRAINT USER_STARSIGNS_FK1 FOREIGN KEY(USER_STARSIGN)
REFERENCES USER_STARSIGNS(USER_STARSIGN_ID) ENABLE; 

COMMENT ON COLUMN USERS.USER_NAME IS 'Username. Will be used in login.';
COMMENT ON COLUMN USERS.USER_PASSWORD IS 'Password. Will be used for authentication.';
COMMENT ON COLUMN USERS.USER_GENDER IS 'Proper values are M or F or NULL.';
COMMENT ON COLUMN USERS.USER_AGE IS 'Proper ages vary from 18 to 150.';
COMMENT ON COLUMN USERS.USER_STARSIGN IS 'User starsign. Valid values are the sign names in Bulgarian or NULL.';
COMMENT ON COLUMN USERS.USER_ONLINE IS 'Values are Y and N. Cannot be NULL.'; 

CREATE TABLE USER_PICTURES
(
  USER_PICTURE_ID NUMBER NOT NULL,
  USER_ID NUMBER UNIQUE NOT NULL,
  USER_PICTURE BLOB NOT NULL,
  CONSTRAINT USER_PICTURES_PK PRIMARY KEY (USER_PICTURE_ID) ENABLE
);

ALTER TABLE USER_PICTURES ADD CONSTRAINT USER_PICTURES_USERS_FK1 FOREIGN KEY(USER_ID)
REFERENCES USERS(USER_ID) ENABLE; 

CREATE TABLE USER_INTERESTS
(
  USER_INTEREST_ID NUMBER NOT NULL,
  USER_ID NUMBER NOT NULL,
  USER_INTEREST NVARCHAR2(2000) NOT NULL,
  CONSTRAINT USER_INTERESTS_PK PRIMARY KEY(USER_INTEREST_ID) ENABLE
);

ALTER TABLE USER_INTERESTS ADD CONSTRAINT USER_INTERESTS_USERS_FK1 FOREIGN KEY(USER_ID)
REFERENCES USERS(USER_ID) ENABLE; 

CREATE TABLE MESSAGES
(
  MESSAGE_ID NUMBER NOT NULL,
  MESSAGE_TIME DATE NOT NULL,
  USER_FROM_ID NUMBER NOT NULL,
  USER_TO_ID NUMBER NOT NULL,
  MESSAGE_TEXT VARCHAR2(4000) NOT NULL,
  CONSTRAINT MESSAGES_PK PRIMARY KEY
  (MESSAGE_ID)  ENABLE
);

ALTER TABLE MESSAGES ADD CONSTRAINT MESSAGES_USERS_FK1 FOREIGN KEY(USER_FROM_ID)
REFERENCES USERS(USER_ID) ON DELETE CASCADE ENABLE;

ALTER TABLE MESSAGES ADD CONSTRAINT MESSAGES_USERS_FK2 FOREIGN KEY(USER_TO_ID)
REFERENCES USERS(USER_ID) ON DELETE CASCADE ENABLE; 

INSERT INTO USER_CITIES(USER_CITY_ID,USER_CITY) VALUES (1,'София');
INSERT INTO USER_CITIES(USER_CITY_ID,USER_CITY) VALUES (2,'Варна');
INSERT INTO USER_CITIES(USER_CITY_ID,USER_CITY) VALUES (3,'Ямбол');
INSERT INTO USER_CITIES(USER_CITY_ID,USER_CITY) VALUES (4,'Пловдив');
INSERT INTO USER_CITIES(USER_CITY_ID,USER_CITY) VALUES (5,'Бургас');
INSERT INTO USER_CITIES(USER_CITY_ID,USER_CITY) VALUES (6,'Ловеч');
INSERT INTO USER_CITIES(USER_CITY_ID,USER_CITY) VALUES (7,'Търново');
INSERT INTO USER_CITIES(USER_CITY_ID,USER_CITY) VALUES (8,'Русе');
INSERT INTO USER_CITIES(USER_CITY_ID,USER_CITY) VALUES (9,'Друг');

INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (1,'Овен');
INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (2,'Телец');
INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (3,'Близнаци');
INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (4,'Рак');
INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (5,'Лъв');
INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (6,'Дева');
INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (7,'Везни');
INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (8,'Скорпион');
INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (9,'Стрелец');
INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (10,'Козирог');
INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (11,'Водолей');
INSERT INTO USER_STARSIGNS(USER_STARSIGN_ID,USER_STARSIGN) VALUES (12,'Риби');

INSERT INTO USERS(USER_ID,USER_NAME,USER_PASSWORD,USER_FULLNAME,USER_CITY,USER_GENDER,USER_AGE,USER_STARSIGN,USER_EMAIL)
VALUES (1,'john','john','Johnathan',1,'M',25,1,'john@gmail.com');
INSERT INTO USERS(USER_ID,USER_NAME,USER_PASSWORD,USER_FULLNAME,USER_CITY,USER_GENDER,USER_AGE,USER_STARSIGN,USER_EMAIL)
VALUES (2,'jim','jim','Jim Johnson',2,'M',35,1,'jim@gmail.com');
INSERT INTO USERS(USER_ID,USER_NAME,USER_PASSWORD,USER_FULLNAME,USER_CITY,USER_GENDER,USER_AGE,USER_STARSIGN,USER_EMAIL)
VALUES (3,'jane','jane','Jane Doe',3,'F',23,2,'jane@gmail.com');
INSERT INTO USERS(USER_ID,USER_NAME,USER_PASSWORD,USER_FULLNAME,USER_CITY,USER_GENDER,USER_AGE,USER_STARSIGN,USER_EMAIL)
VALUES (4,'amy','amy','Amy Amidala',1,'M',25,NULL,'amy@gmail.com');

INSERT INTO USER_PICTURES(USER_PICTURE_ID,USER_ID,USER_PICTURE) VALUES (1,1,EMPTY_BLOB());
INSERT INTO USER_PICTURES(USER_PICTURE_ID,USER_ID,USER_PICTURE) VALUES (2,2,EMPTY_BLOB());
INSERT INTO USER_PICTURES(USER_PICTURE_ID,USER_ID,USER_PICTURE) VALUES (3,3,EMPTY_BLOB());

INSERT INTO USER_INTERESTS(USER_INTEREST_ID,USER_ID,USER_INTEREST) VALUES (1,1,'Skiing, Driving');
INSERT INTO USER_INTERESTS(USER_INTEREST_ID,USER_ID,USER_INTEREST) VALUES (2,2,'Skydiving, Gambling');
INSERT INTO USER_INTERESTS(USER_INTEREST_ID,USER_ID,USER_INTEREST) VALUES (3,3,'Being very uninteresting');

INSERT INTO MESSAGES(MESSAGE_ID,MESSAGE_TIME,USER_FROM_ID,USER_TO_ID,MESSAGE_TEXT) VALUES (1,TO_DATE('27-JAN-2007','DD-MON-YYYY'),1,2,'Hello!');
INSERT INTO MESSAGES(MESSAGE_ID,MESSAGE_TIME,USER_FROM_ID,USER_TO_ID,MESSAGE_TEXT) VALUES (2,TO_DATE('27-JAN-2007','DD-MON-YYYY'),2,1,'Hello to you too!');
INSERT INTO MESSAGES(MESSAGE_ID,MESSAGE_TIME,USER_FROM_ID,USER_TO_ID,MESSAGE_TEXT) VALUES (3,TO_DATE('27-JAN-2007','DD-MON-YYYY'),3,2,'What are you talking about?!');
INSERT INTO MESSAGES(MESSAGE_ID,MESSAGE_TIME,USER_FROM_ID,USER_TO_ID,MESSAGE_TEXT) VALUES (4,TO_DATE('27-JAN-2007','DD-MON-YYYY'),1,3,'This is the fourth message so far!');
INSERT INTO MESSAGES(MESSAGE_ID,MESSAGE_TIME,USER_FROM_ID,USER_TO_ID,MESSAGE_TEXT) VALUES (5,TO_DATE('27-JAN-2007','DD-MON-YYYY'),2,3,'Enough messages!');

COMMIT;